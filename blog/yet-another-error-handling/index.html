<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="Prime Type Ltd, the company that will provide you with the cryptographic tools to enhance and secure your business.">
    <meta name="author" content="Nicolas Di Prima">
    <title>Prime Type</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
        integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">

    <link href="https:&#x2F;&#x2F;primetype.co.uk&#x2F;/style.css" rel="stylesheet">

</head>




<body role="document" id="home">
    <nav class="navbar navbar-expand navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="https:&#x2F;&#x2F;primetype.co.uk">
                Prime Type
            </a>

            <div class="navbar-collapse">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="https:&#x2F;&#x2F;primetype.co.uk#home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https:&#x2F;&#x2F;primetype.co.uk&#x2F;blog">Blog</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    
<div class="p-5 mb-4 bg-danger text-white">
    <div class="container">
        <div class="row">
            <div class="col-md-2 text-center mh-100">
                <span class="h-resp-fa align-middle mh-100">
                    
                    <i class="fas fa-car-crash"></i>
                    
                </span>
            </div>
            <div class="col">
                <h1 class="h-title">C++: Yet Another Kind of error handling (Part 1)</h1>
                <p class="h-lead">Self document your code and let users decide how to handle error</p>
                <p>
                    Saturday 11 June 2016
                    
                </p>
            </div>
        </div>
    </div>
</div>
<div class="container py-5 page">
    <div class="row">
        <div class="col">
            <p>I have been a C++ developer for a little while, I have seen different methods
to provide meaningful API:</p>
<ul>
<li>the <strong>C-like</strong>: using error code and returning output in the parameter;</li>
<li>the <strong>exception-like</strong>: using exceptions.</li>
</ul>
<p>The difficulties are to:</p>
<ul>
<li>guarantee that the error handling is documented;</li>
<li>ensure it does not change (requires a lot of regression tests);</li>
<li>keep undefined behaviours as &quot;exceptional&quot;.</li>
</ul>
<p>That's it: exceptions are for exceptional situations. And again, it is not
easy to provide up to date documentation of the kind of exceptions
your function may throw.</p>
<p>So, let's try something else. Let's see what other languages have done to
try to solve the issue of non self documented APIs.</p>
<span id="continue-reading"></span><h1 id="haskell">Haskell</h1>
<p>Certainly my favourite language. In Haskell there are different methods
to return error information to the user. The simplest
is <strong>Either</strong> or <strong>Maybe</strong>.</p>
<pre style="background-color:#2b303b;">
<code class="language-haskell" data-lang="haskell"><span style="color:#65737e;">-- define an error type
</span><span style="color:#b48ead;">data </span><span style="color:#d08770;">Error </span><span style="color:#c0c5ce;">= </span><span style="color:#d08770;">IOError
           </span><span style="color:#c0c5ce;">| </span><span style="color:#d08770;">UTF8Error

</span><span style="color:#65737e;">-- just provide the Function signature to show you how
-- self documented it is
</span><span style="color:#8fa1b3;">readFile </span><span style="color:#b48ead;">:: FilePath -&gt; Either Error Text
</span></code></pre>
<p>So the function is named: <strong>readFile</strong>, it takes a <strong>FilePath</strong> as parameter
and it returns either an <strong>Error</strong> or a <strong>Text</strong>.</p>
<p>This design provides you with some information about the kind of error handled
by this function. I don't say this function won't throw an exception: but the
signature of the function tells you what you can expect.</p>
<p>Now, you know how you can use it:</p>
<p><strong>If you want to interrupt your program now:</strong></p>
<pre style="background-color:#2b303b;">
<code class="language-haskell" data-lang="haskell"><span style="color:#c0c5ce;">main = </span><span style="color:#b48ead;">do
   case</span><span style="color:#c0c5ce;"> readFile &quot;</span><span style="color:#a3be8c;">document.txt</span><span style="color:#c0c5ce;">&quot; </span><span style="color:#b48ead;">of
      </span><span style="color:#d08770;">Left</span><span style="color:#c0c5ce;"> err -&gt; error $ &quot;</span><span style="color:#a3be8c;">error in readFile: </span><span style="color:#c0c5ce;">&quot; ++ show err
      </span><span style="color:#d08770;">Right</span><span style="color:#c0c5ce;"> txt -&gt; printLn txt
</span></code></pre>
<p><strong>If you want to fail quietly</strong></p>
<pre style="background-color:#2b303b;">
<code class="language-haskell" data-lang="haskell"><span style="color:#c0c5ce;">main = </span><span style="color:#b48ead;">do
</span><span style="color:#c0c5ce;">   either
      (return </span><span style="color:#d08770;">()</span><span style="color:#c0c5ce;">)
      print
      (readFile &quot;</span><span style="color:#a3be8c;">document.txt</span><span style="color:#c0c5ce;">&quot;)
</span></code></pre><h1 id="rust">Rust</h1>
<p>The latest language I have been looking into. Full of
<a href="http://groveronline.com/2016/06/why-rust-for-low-level-linux-programming/">promise</a>
for the System Developers.</p>
<p>The error management is also very simple and self documented:
<a href="https://doc.rust-lang.org/std/result/enum.Result.html">Result</a>.</p>
<pre style="background-color:#2b303b;">
<code class="language-rust" data-lang="rust"><span style="color:#b48ead;">enum </span><span style="color:#c0c5ce;">Error {
  IOError,
  UTF8Error
}

</span><span style="color:#b48ead;">fn </span><span style="color:#8fa1b3;">readfile</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">f</span><span style="color:#c0c5ce;">: Path) -&gt; Result&lt;Error, String&gt;;
</span></code></pre>
<p>And now you can, the same way you would do in Haskell:</p>
<p><strong>throw the error</strong></p>
<pre style="background-color:#2b303b;">
<code class="language-rust" data-lang="rust"><span style="color:#65737e;">// unwrap() will throw an exception (panic!)
</span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> txt = readFile(&quot;</span><span style="color:#a3be8c;">document.txt</span><span style="color:#c0c5ce;">&quot;).</span><span style="color:#96b5b4;">unwrap</span><span style="color:#c0c5ce;">();
println!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#c0c5ce;">&quot;, txt);
</span></code></pre>
<p><strong>or fail quietly</strong></p>
<pre style="background-color:#2b303b;">
<code class="language-rust" data-lang="rust"><span style="color:#65737e;">// only execute the lamba in the function succeed
</span><span style="color:#c0c5ce;">readFile(&quot;</span><span style="color:#a3be8c;">document.txt</span><span style="color:#c0c5ce;">&quot;)
  .</span><span style="color:#96b5b4;">and_then</span><span style="color:#c0c5ce;">(|</span><span style="color:#bf616a;">txt</span><span style="color:#c0c5ce;">| println!(&quot;</span><span style="color:#d08770;">{}</span><span style="color:#c0c5ce;">&quot;, txt));
</span></code></pre><h1 id="conclusion">Conclusion</h1>
<p>Personally, I like these kind of APIs. They provide a typed error
code and users have the choice to handle errors the way they want.
I believe it should be possible to do the same in C++.
In a second post, I will try to implement a <strong>Rust</strong> like <em>Result</em> in C++11.</p>

        </div>
    </div>

    <div class="row">
        <div class="col">
            <hr class="my-4">
        </div>
    </div>

    <div class="row">
        <div class="col-6 text-start">
            
        </div>
        <div class="col-6 text-end">
            

            <a class="btn btn-outline-danger" href="https:&#x2F;&#x2F;primetype.co.uk&#x2F;blog&#x2F;yet-another-error-handling-2&#x2F;" data-toggle="tooltip"
                data-placement="bottom" title="C++: Yet Another Kind of error handling (Part 2)">
                C++: Yet Another Kinâ€¦
                <i class="fas fa-arrow-right"></i>
            </a>
            
        </div>
    </div>
</div>


    <footer class="bg-dark text-center text-lg-start text-white">
        <!-- Grid container -->
        <div class="container p-4">
            <!--Grid row-->
            <div class="row mt-4">
                <!--Grid column-->
                <div class="col-md-6 mb-4 mb-md-0">
                    <h5 class="text-uppercase">Legals</h5>

                    <p>
                        <em>Prime Type Ltd</em> is a limited company registered in
                        <em>England and Wales</em>.<br>
                        <em>Registration number&nbsp;10597758</em>.<br>
                        <em>VAT registration number&nbsp;295196950.</em>
                    </p>
                </div>
                <!--Grid column-->

                <!--Grid column-->
                <div class="col-md-6 mb-4 mb-md-0">
                    <h5 class="text-uppercase">Write to us</h5>

                    <ul class="list-unstyled">
                        <li>
                            <a href="mailto:info@primetype.co.uk" class="text-white">
                                <i class="fas fa-at fa-fw fa-sm me-2"></i>
                                info@primetype.co.uk
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/primetype" target="_blank" class="text-white">
                                <i class="fab fa-github fa-fw fa-sm me-2"></i>
                                Check us out on github
                            </a>
                        </li>
                    </ul>
                </div>
                <!--Grid column-->
            </div>
            <!--Grid row-->
        </div>
        <!-- Grid container -->

        <!-- Copyright -->
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2)">
            Copyright
            <i class="far fa-copyright"></i>
            2017-2021 Prime Type Ltd
            <br>
        </div>
        <!-- Copyright -->
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
</body>

</html>